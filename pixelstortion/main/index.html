<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PIXELSTORTION | CHOOSE YOUR REALITY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Space+Grotesk:wght@300;400;500;600;700&family=Bebas+Neue&family=Share+Tech+Mono&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0">

    <!-- Centralized URL Manifest - MUST be loaded before other scripts -->
    <script
        src="https://raw.githack.com/NJsalubrious/pixelstortion-assets/893672eef0e85ff0b8197f80e4387ee9ab3e71c1/pixelstortion/site-manifest.js"></script>

    <style>
        :root {
            --neon-green: #00ff41;
            --fire-orange: #ff4500;
            --void: #050505;
        }

        /* --- 1. PHYSICS & VIEWPORT LOCK --- */
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--void);
            overflow: hidden;
            /* No scrollbars */
            font-family: 'Space Grotesk', sans-serif;

            /* CRITICAL: Disables Pull-to-Refresh & Rubber-banding */
            overscroll-behavior: none;
            /* Allow vertical pan for mobile panel switching */
            touch-action: pan-y pinch-zoom;

            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        /* --- 2. LAYOUT ENGINE --- */
        .split-container {
            display: flex;
            width: 100vw;
            height: 100vh;
            /* Fallback */
            height: 100dvh;
            /* Mobile Address Bar Fix */
            position: relative;
        }

        /* Mobile viewport fix */
        @media (max-width: 768px) {
            .split-container {
                min-height: 100vh;
                min-height: 100dvh;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
            }
        }

        .panel {
            flex: 1;
            position: relative;
            transition: flex 0.6s cubic-bezier(0.25, 1, 0.5, 1), filter 0.5s;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            touch-action: manipulation;
        }

        /* --- 3. DESKTOP LOGIC (Hover) --- */
        @media (min-width: 769px) {
            .split-container {
                flex-direction: row;
            }

            .panel:hover {
                flex: 2.5;
                z-index: 10;
            }

            .split-container:has(.panel:hover) .panel:not(:hover) {
                filter: grayscale(100%) brightness(0.15) blur(3px);
            }

            /* Reveal Buttons & Content on Hover */
            .panel:hover .btn-tech,
            .panel:hover .btn-war {
                opacity: 1;
                transform: translateY(0);
                pointer-events: auto;
            }

            .left-panel:hover .redacted-bar {
                transform: scaleX(0);
            }

            /* Hide Mobile Elements */
            .mobile-sliver-label,
            .mobile-hint {
                display: none !important;
            }
        }

        /* --- 4. MOBILE LOGIC (Tap to Arm) --- */
        @media (max-width: 768px) {
            .split-container {
                flex-direction: column;
            }

            /* Vertical Stack */

            /* Default: Equal Split, dimmed */
            .panel {
                flex: 1;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            /* ACTIVE STATE: Expanded (The "Armed" Weapon) */
            .panel.active {
                flex: 6;
                z-index: 20;
                filter: brightness(1.1);
            }

            /* INACTIVE STATE: Crushed (The "Sliver") */
            .panel.inactive {
                flex: 1;
                filter: grayscale(100%) brightness(0.2);
            }

            /* Hide content in sliver, show label */
            .panel.inactive .content-layer {
                opacity: 0;
                pointer-events: none;
            }

            .panel.inactive .mobile-sliver-label {
                opacity: 1;
                transition-delay: 0.2s;
            }

            /* Reveal Controls when Active */
            .panel.active .btn-tech,
            .panel.active .btn-war {
                opacity: 1;
                transform: translateY(0);
                pointer-events: auto;
            }

            .left-panel.active .redacted-bar {
                transform: scaleX(0);
            }

            .panel.active .mobile-hint {
                display: none;
            }
        }

        /* --- 5. PANEL CONTENT --- */
        .content-layer {
            position: relative;
            z-index: 40;
            text-align: center;
            max-width: 600px;
            padding: 2rem;
            opacity: 1;
            transition: opacity 0.3s;
            width: 100%;
            /* Let clicks pass through to panel unless it's a button */
            pointer-events: none;
        }

        .content-layer a,
        .content-layer button {
            pointer-events: auto;
        }

        /* The Vertical Label for Crushed Panels */
        .mobile-sliver-label {
            opacity: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 0.2em;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 50;
            color: white;
            white-space: nowrap;
            text-shadow: 0 0 10px currentColor;
        }

        /* --- LEFT PANEL: SILENCE --- */
        .left-panel {
            background: #000;
        }

        #staticCanvas {
            position: absolute;
            inset: 0;
            opacity: 0.03;
            mix-blend-mode: screen;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            background-size: 200px 200px;
            animation: staticMove 8s infinite;
        }

        @keyframes staticMove {
            0% {
                transform: translate(0, 0);
            }

            25% {
                transform: translate(-2%, 2%);
            }

            50% {
                transform: translate(2%, -2%);
            }

            75% {
                transform: translate(-2%, -2%);
            }

            100% {
                transform: translate(0, 0);
            }
        }

        /* --- DYNAMIC CURSOR MATCHING --- */

        /* ETHEL (Amber) */
        body:has(.left-panel.vibe-ethel) #cursor {
            border-color: #ffaa33;
            background: rgba(255, 170, 51, 0.1);
            box-shadow: 0 0 20px rgba(255, 170, 51, 0.4);
        }

        /* ISLA (Blue/Purple) */
        body:has(.left-panel.vibe-isla) #cursor {
            border-color: #6b7aff;
            background: rgba(107, 122, 255, 0.1);
            box-shadow: 0 0 20px rgba(107, 122, 255, 0.4);
        }

        /* DOMINIC (Red) */
        body:has(.left-panel.vibe-dominic) #cursor {
            border-color: #ff3333;
            background: rgba(255, 51, 51, 0.1);
            box-shadow: 0 0 20px rgba(255, 51, 51, 0.4);
        }

        /* WITNESS (Red) */
        body:has(.left-panel.vibe-witness) #cursor {
            border-color: #ff3333;
            background: rgba(255, 51, 51, 0.1);
            box-shadow: 0 0 20px rgba(255, 51, 51, 0.4);
        }

        /* KINLEY (Dark Gray) */
        body:has(.left-panel.vibe-kinley) #cursor {
            border-color: #666;
            background: rgba(100, 100, 100, 0.1);
            box-shadow: 0 0 20px rgba(100, 100, 100, 0.4);
        }

        /* STICKY (Light Blue) */
        body:has(.left-panel.vibe-sticky) #cursor {
            border-color: #5dade2;
            background: rgba(93, 173, 226, 0.1);
            box-shadow: 0 0 20px rgba(93, 173, 226, 0.4);
        }

        /* --- CHARACTER VIBE EFFECTS (Ramped Up) --- */

        /* VIBE: ISLA (Controlled Chaos) - Blue/Purple */
        .left-panel.vibe-isla {
            background: #000;
            transition: background 1s ease;
        }

        .left-panel.vibe-isla #staticCanvas {
            animation-duration: 8s;
            /* Faster chaos */
            opacity: 0.3;
            /* More intense */
            filter: contrast(140%) brightness(120%);
            mix-blend-mode: overlay;
        }

        .left-panel.vibe-isla #glitchTitle {
            animation: textShudder 0.08s infinite;
            text-shadow: 3px 0 0 rgba(255, 0, 0, 0.5), -3px 0 0 rgba(0, 255, 255, 0.5);
        }

        /* ISLA Color Scheme - Blue/Purple */
        .left-panel.vibe-isla #subtitleText {
            color: #6b7aff !important;
        }

        .left-panel.vibe-isla .text-gray-500 {
            color: #8b9aff !important;
        }

        .left-panel.vibe-isla .redacted-wrapper {
            color: #8b9aff;
        }

        .left-panel.vibe-isla .border-green-900 {
            border-color: #6b7aff !important;
        }

        .left-panel.vibe-isla .text-green-500 {
            color: #8b9aff !important;
        }

        .left-panel.vibe-isla .btn-tech {
            border-color: #6b7aff;
            color: #8b9aff;
            background: rgba(0, 0, 20, 0.8);
            box-shadow: 0 0 15px rgba(107, 122, 255, 0.4);
        }

        .left-panel.vibe-isla #glitchTitle {
            color: #8b9aff !important;
            text-shadow: 3px 0 0 rgba(255, 0, 0, 0.5), -3px 0 0 rgba(0, 255, 255, 0.5);
        }

        .left-panel.vibe-isla .redacted-bar {
            background: #6b7aff;
        }

        /* VIBE: ETHEL (Focused Momentum) - Warm Amber */
        .left-panel.vibe-ethel {
            background: #000;
            transition: background 1s ease;
        }

        .left-panel.vibe-ethel #staticCanvas {
            animation-duration: 25s;
            opacity: 0.15;
            filter: contrast(180%) saturate(0%);
        }

        .left-panel.vibe-ethel #glitchTitle {
            text-shadow: 0 0 20px var(--neon-green), 0 0 40px var(--neon-green);
            letter-spacing: -3px;
            /* Tighter, more focused */
            transition: letter-spacing 0.5s, text-shadow 0.5s;
        }

        /* ETHEL Color Scheme - Warm Amber */
        .left-panel.vibe-ethel #subtitleText {
            color: #ffaa33 !important;
        }

        .left-panel.vibe-ethel .text-gray-500 {
            color: #ffcc66 !important;
        }

        .left-panel.vibe-ethel .redacted-wrapper {
            color: #ffcc66;
        }

        .left-panel.vibe-ethel .border-green-900 {
            border-color: #ffaa33 !important;
        }

        .left-panel.vibe-ethel .text-green-500 {
            color: #ffcc66 !important;
        }

        .left-panel.vibe-ethel .btn-tech {
            border-color: #ffaa33;
            color: #ffcc66;
            background: rgba(20, 10, 0, 0.8);
            box-shadow: 0 0 15px rgba(255, 170, 51, 0.4);
        }

        .left-panel.vibe-ethel #glitchTitle {
            color: #ffcc66 !important;
            text-shadow: 0 0 20px #ffaa33, 0 0 40px #ffaa33;
        }

        .left-panel.vibe-ethel .redacted-bar {
            background: #ffaa33;
        }

        /* VIBE: DOMINIC (Calm Menace) - Red Spider */
        .left-panel.vibe-dominic {
            background: #000;
            transition: background 1.5s ease;
        }

        .left-panel.vibe-dominic #staticCanvas {
            animation-duration: 100s;
            /* Very slow, ominous */
            opacity: 0.08;
            filter: brightness(0.3) sepia(30%);
        }

        .left-panel.vibe-dominic #glitchTitle {
            color: #ccc;
            text-shadow: 0 0 5px rgba(255, 51, 51, 0.3);
            letter-spacing: 1px;
            transition: color 0.8s, text-shadow 0.8s;
        }

        /* DOMINIC Color Scheme - Red Spider/Redback */
        .left-panel.vibe-dominic #subtitleText {
            color: #ff3333 !important;
        }

        .left-panel.vibe-dominic .text-gray-500 {
            color: #ff6666 !important;
        }

        .left-panel.vibe-dominic .redacted-wrapper {
            color: #ff6666;
            background: transparent;
            border: none;
            /* Remove border */
        }

        .left-panel.vibe-dominic .border-green-900 {
            border-color: #ff3333 !important;
        }

        .left-panel.vibe-dominic .text-green-500 {
            color: #ff6666 !important;
        }

        .left-panel.vibe-dominic .btn-tech {
            border-color: #ff3333;
            color: #ff6666;
            background: rgba(20, 0, 0, 0.8);
            box-shadow: 0 0 15px rgba(255, 51, 51, 0.4);
        }

        .left-panel.vibe-dominic #glitchTitle {
            color: #ff6666 !important;
            text-shadow: 0 0 5px rgba(255, 51, 51, 0.3);
        }

        .left-panel.vibe-dominic .redacted-bar {
            background: #ff3333;
        }

        /* VIBE: WITNESS (Unknown/Neutral) - Red Spider */
        .left-panel.vibe-witness {
            background: #000;
            transition: background 1s ease;
        }

        .left-panel.vibe-witness #staticCanvas {
            animation-duration: 50s;
            opacity: 0.05;
            filter: brightness(0.6);
        }

        /* WITNESS Color Scheme - Red Spider/Redback */
        .left-panel.vibe-witness #subtitleText {
            color: #ff3333 !important;
        }

        .left-panel.vibe-witness .text-gray-500 {
            color: #ff6666 !important;
        }

        .left-panel.vibe-witness .redacted-wrapper {
            color: #ff6666;
            background: #000;
            border: 1px solid #ff3333;
        }

        .left-panel.vibe-witness .border-green-900 {
            border-color: #ff3333 !important;
        }

        .left-panel.vibe-witness .text-green-500 {
            color: #ff6666 !important;
        }

        .left-panel.vibe-witness .btn-tech {
            border-color: #ff3333;
            color: #ff6666;
            background: rgba(20, 0, 0, 0.8);
            box-shadow: 0 0 15px rgba(255, 51, 51, 0.4);
        }

        .left-panel.vibe-witness #glitchTitle {
            color: #ff6666 !important;
        }

        .left-panel.vibe-witness .redacted-wrapper {
            color: #ff6666;
            background: transparent;
            border: 1px solid #ff3333;
        }

        .left-panel.vibe-witness .redacted-bar {
            background: #ff3333;
        }

        /* 5. KINLEY - Dark Gold (Corrupt Politician) */
        .left-panel.vibe-kinley {
            background: #000;
            transition: background 1s ease;
        }

        .left-panel.vibe-kinley #staticCanvas {
            animation-duration: 120s;
            /* Very slow, oppressive */
            opacity: 0.15;
            filter: brightness(0.3) sepia(70%) hue-rotate(30deg) contrast(150%);
        }

        .left-panel.vibe-kinley #glitchTitle {
            color: #ccc !important;
            /* Light gray - heavy but readable */
            text-shadow:
                0 0 50px rgba(150, 150, 150, 1),
                0 0 30px rgba(150, 150, 150, 0.8),
                0 6px 0 rgba(0, 0, 0, 0.9);
            /* Heavy drop shadow for weight */
            font-weight: 900;
        }

        .left-panel.vibe-kinley #subtitleText {
            color: #888 !important;
            /* Dark gray */
            letter-spacing: 0.5em;
            /* Wide for institutional feel */
        }

        .left-panel.vibe-kinley .text-gray-500 {
            color: #999 !important;
            /* Medium gray */
        }

        .left-panel.vibe-kinley .redacted-wrapper {
            color: #aaa;
            /* Light gray */
            background: transparent;
            border: none;
            /* Remove border */
        }

        .left-panel.vibe-kinley .border-green-900 {
            border-color: #666 !important;
            /* Dark gray */
            border-width: 2px !important;
            box-shadow: 0 0 20px rgba(100, 100, 100, 0.3), inset 0 0 20px rgba(100, 100, 100, 0.1);
        }

        .left-panel.vibe-kinley .text-green-500 {
            color: #aaa !important;
            /* Light gray */
        }

        .left-panel.vibe-kinley .btn-tech {
            border-color: #666;
            /* Dark gray */
            border-width: 2px;
            color: #aaa;
            /* Light gray */
            background: rgba(30, 30, 30, 0.9);
            /* Dark gray background */
            box-shadow: 0 0 25px rgba(100, 100, 100, 0.6), 0 4px 0 rgba(0, 0, 0, 0.5);
            font-weight: 700;
            letter-spacing: 0.3em;
        }

        .left-panel.vibe-kinley .redacted-bar {
            background: #666;
            /* Dark gray */
        }

        /* 6. STICKY - Light Blue (Honest Cop) */
        .left-panel.vibe-sticky {
            background: #000;
            transition: background 1s ease;
        }

        .left-panel.vibe-sticky #staticCanvas {
            animation-duration: 40s;
            opacity: 0.12;
            filter: brightness(0.8) saturate(120%);
        }

        .left-panel.vibe-sticky #glitchTitle {
            color: #5dade2 !important;
            /* Light Blue */
            text-shadow: 0 0 18px rgba(93, 173, 226, 0.6);
        }

        .left-panel.vibe-sticky #subtitleText {
            color: #5dade2 !important;
        }

        .left-panel.vibe-sticky .text-gray-500 {
            color: #85c1e9 !important;
        }

        .left-panel.vibe-sticky .redacted-wrapper {
            color: #85c1e9;
            background: transparent;
        }

        .left-panel.vibe-sticky .border-green-900 {
            border-color: #5dade2 !important;
        }

        .left-panel.vibe-sticky .text-green-500 {
            color: #85c1e9 !important;
        }

        .left-panel.vibe-sticky .btn-tech {
            border-color: #5dade2;
            color: #85c1e9;
            background: rgba(0, 10, 20, 0.8);
            box-shadow: 0 0 15px rgba(93, 173, 226, 0.4);
        }

        .left-panel.vibe-sticky .redacted-bar {
            background: #5dade2;
        }

        /* NALANI bounce animation */
        @keyframes nalaniBounce {

            0%,
            100% {
                transform: scale(1);
            }

            25% {
                transform: scale(1.15);
            }

            50% {
                transform: scale(0.95);
            }

            75% {
                transform: scale(1.05);
            }
        }

        .nalani-container.bounce {
            animation: nalaniBounce 0.5s ease;
        }

        @keyframes textShudder {
            0% {
                transform: translate(0, 0);
            }

            25% {
                transform: translate(2px, 1px);
            }

            50% {
                transform: translate(-1px, -1px);
            }

            75% {
                transform: translate(1px, -2px);
            }

            100% {
                transform: translate(0, 0);
            }
        }

        .redacted-wrapper {
            background: transparent;
            color: var(--neon-green);
            padding: 2px 6px;
            font-family: 'Share Tech Mono', monospace;
            position: relative;
            display: inline-block;
        }

        .redacted-bar {
            position: absolute;
            inset: 0;
            background: var(--neon-green);
            transition: transform 0.4s ease;
            transform-origin: left;
        }

        .btn-tech {
            display: inline-block;
            font-family: 'Courier Prime', monospace;
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
            background: rgba(0, 20, 0, 0.8);
            padding: 15px 40px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-decoration: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease 0.2s;
            pointer-events: none;
            /* SAFETY CATCH: Not clickable until revealed */
            margin-top: 2rem;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.1);
        }

        /* --- RIGHT PANEL: MATAALA --- */
        .right-panel {
            background: #0a0200;
        }

        .bg-war {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.6;
            filter: contrast(140%) brightness(0.5) sepia(30%);
            pointer-events: none;
        }

        .nalani-container {
            width: 100%;
            max-width: 500px;
            aspect-ratio: 2.5/1;
            position: relative;
            margin: 0 auto;
            filter: drop-shadow(0 0 15px rgba(255, 60, 0, 0.4));
            transform: scale(0.9);
            transition: transform 0.6s;
        }

        .right-panel:hover .nalani-container,
        .right-panel.active .nalani-container {
            transform: scale(1.05);
        }

        .nalani-mask {
            position: absolute;
            inset: 0;
            -webkit-mask-image: url('https://raw.githubusercontent.com/NJsalubrious/pixelstortion-assets/67296a57b902e42ac6c72977fac5d6eb0bdc8e09/assets_for_nalani_song/Images_misc/Nalani_type_shadow.png');
            mask-image: url('https://raw.githubusercontent.com/NJsalubrious/pixelstortion-assets/67296a57b902e42ac6c72977fac5d6eb0bdc8e09/assets_for_nalani_song/Images_misc/Nalani_type_shadow.png');
            -webkit-mask-size: contain;
            mask-size: contain;
            -webkit-mask-repeat: no-repeat;
            mask-position: center;
        }

        .nalani-fill {
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, #fff 0%, #ffaa00 30%, #ff4500 60%, #550000 100%);
        }

        .fire-turbulence {
            position: absolute;
            inset: -50%;
            width: 200%;
            height: 200%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.05' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.5'/%3E%3C/svg%3E");
            mix-blend-mode: soft-light;
            animation: fireFlow 3s infinite linear;
        }

        @keyframes fireFlow {
            0% {
                transform: translateY(0);
            }

            100% {
                transform: translateY(-20%);
            }
        }

        .btn-war {
            display: inline-block;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            color: #ffaa00;
            border: 2px solid rgba(255, 170, 0, 0.3);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 40px;
            letter-spacing: 3px;
            text-decoration: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease 0.2s;
            pointer-events: none;
            /* SAFETY CATCH */
            margin-top: 2rem;
            box-shadow: 0 0 15px rgba(255, 69, 0, 0.1);
        }

        /* --- FISSURE (Divider) --- */
        .fissure {
            position: absolute;
            z-index: 50;
            background: #fff;
            pointer-events: none;
            transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        /* Desktop */
        @media (min-width: 769px) {
            .fissure {
                left: 50%;
                top: 0;
                bottom: 0;
                width: 2px;
            }

            .split-container:has(.left-panel:hover) .fissure {
                left: 71.5%;
                background: var(--neon-green);
            }

            .split-container:has(.right-panel:hover) .fissure {
                left: 28.5%;
                background: var(--fire-orange);
            }
        }

        /* Mobile */
        @media (max-width: 768px) {
            .fissure {
                top: 50%;
                left: 0;
                right: 0;
                height: 2px;
                width: 100%;
            }

            .split-container:has(.left-panel.active) .fissure {
                top: 85%;
                background: var(--neon-green);
            }

            .split-container:has(.right-panel.active) .fissure {
                top: 15%;
                background: var(--fire-orange);
            }
        }

        /* --- TAP HINT (Mobile Only) --- */
        .mobile-hint {
            display: none;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.7rem;
            opacity: 0.6;
            margin-top: 15px;
            letter-spacing: 1px;
            animation: pulse 2s infinite;
        }

        @media (max-width: 768px) {
            .mobile-hint {
                display: block;
            }
        }

        @keyframes pulse {
            0% {
                opacity: 0.3;
            }

            50% {
                opacity: 0.8;
            }

            100% {
                opacity: 0.3;
            }
        }

        /* --- CUSTOM CURSOR (Desktop Only) --- */
        @media (pointer: fine) {
            body {
                cursor: none;
            }

            #cursor {
                position: fixed;
                top: 0;
                left: 0;
                width: 20px;
                height: 20px;
                border: 1px solid white;
                border-radius: 50%;
                pointer-events: none;
                z-index: 9999;
                transform: translate(-50%, -50%);
                mix-blend-mode: difference;
                transition: all 0.3s;
            }

            body.hover-left #cursor {
                width: 60px;
                height: 60px;
                border-radius: 0;
                background: rgba(0, 255, 65, 0.1);
                border-color: var(--neon-green);
            }

            body.hover-right #cursor {
                width: 60px;
                height: 60px;
                border-radius: 50%;
                background: rgba(255, 69, 0, 0.1);
                border-color: var(--fire-orange);
            }
        }

        @media (pointer: coarse),
        (max-width: 768px) {
            #cursor {
                display: none !important;
            }

            body {
                cursor: auto;
            }
        }

        /* --- REMOVE STATIC BACKGROUND COMPLETELY --- */
        #staticCanvas {
            display: none !important;
        }

        /* --- MOBILE LAYOUT FIXES --- */
        @media (max-width: 768px) {

            /* 1. POSITION THE ENCRYPTED BOX */
            .left-panel {
                justify-content: flex-start !important;
                /* Aligns content to top instead of center */
                padding-top: 2vh !important;
                /* Moves ENCRYPTED box up/down */
            }

            /* 2. GAP SIZE & SILENCE TEXT SIZE */
            #glitchTitle {
                /* --- CONTROL SILENCE TITLE HERE --- */
                font-size: 4.5rem !important;
                /* Adjust this number to size "SILENCE" */

                /* Gap between Encrypted box and Title */
                margin-top: 2vh !important;
                margin-bottom: 1rem !important;
                line-height: 0.85;
            }

            /* 3. Subtitle Sizing */
            #subtitleText {
                font-size: 1.1rem !important;
                letter-spacing: 0.3em !important;
            }

            /* --- CHARACTER SPECIFIC SIZES (These override the Silence size above) --- */

            /* ISLA: Needs to be huge (short name) */
            .left-panel.vibe-isla #glitchTitle {
                font-size: 6.5rem !important;
            }

            /* ETHEL: Medium-Large */
            .left-panel.vibe-ethel #glitchTitle {
                font-size: 5.5rem !important;
            }

            /* DOMINIC: Smaller to fit width */
            .left-panel.vibe-dominic #glitchTitle {
                font-size: 4rem !important;
            }

            /* WITNESS: Medium */
            .left-panel.vibe-witness #glitchTitle {
                font-size: 4.5rem !important;
            }

            /* KINLEY: Medium */
            .left-panel.vibe-kinley #glitchTitle {
                font-size: 4.8rem !important;
            }

            /* STICKY: Medium */
            .left-panel.vibe-sticky #glitchTitle {
                font-size: 4.8rem !important;
            }
        }
    </style>
</head>

<body>

    <div id="cursor"></div>

    <div class="split-container group">

        <div class="panel left-panel" id="leftPanel">
            <div id="staticCanvas"></div>

            <div class="mobile-sliver-label text-green-500">SILENCE</div>

            <div class="content-layer">
                <div class="mb-4 inline-flex items-center gap-2 border border-green-900 bg-black/80 px-3 py-1">
                    <span class="material-symbols-outlined text-green-500 text-sm animate-pulse">lock</span>
                    <span class="font-mono text-[10px] text-green-500 tracking-[0.2em]">ENCRYPTED</span>
                </div>

                <h2 class="text-4xl md:text-7xl font-bold text-white mb-6 tracking-tighter" id="glitchTitle">
                    SILENCE
                </h2>

                <h3 id="subtitleText" class="font-mono text-sm md:text-xl text-green-500/50 mb-8 tracking-[0.3em]">IS
                    THE TRAUMA</h3>

                <div class="text-left font-mono text-xs md:text-sm leading-7 space-y-2 max-w-sm mx-auto">
                    <div>
                        <span class="text-gray-500">STATUS:</span>
                        <span class="redacted-wrapper">SILENCE<span class="redacted-bar"></span></span>
                    </div>
                    <div>
                        <span class="text-gray-500">MESSAGE:</span>
                        <span class="redacted-wrapper">"Silence isn't absence."<span class="redacted-bar"></span></span>
                    </div>
                </div>

                <div class="mobile-hint text-green-500">[ TAP TO ARM ]</div>

                <a href="#" class="btn-tech"
                    onclick="event.stopPropagation(); window.top.location.href = PIXEL_MANIFEST.SILENCE; return false;">
                    ENTER
                </a>
            </div>
        </div>

        <div class="fissure"></div>

        <div class="panel right-panel" id="rightPanel">
            <img src="https://lh3.googleusercontent.com/gg-dl/ABS2GSmcodSdYCgwQuT4Mrue8Hw-f4HEY0g2LcIPgmbEvc3I1GB26-IE051za1DkUhNOw2XvDLVbM_ToGq3Bj0Gv_toMCP-idJA8_HNBb9RDegC5qdH3dBW8jKpZ4yuZDgc3JsZnJG5AogwXM7SkmwG0i8xvXQKYFCccjVmMaJWx8NQSsqWXSg"
                alt="Warzone" class="bg-war" id="bgWar">

            <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-black/80 pointer-events-none">
            </div>

            <div class="mobile-sliver-label text-orange-500">MATAALA</div>

            <div class="content-layer">
                <div
                    class="mb-4 inline-flex items-center gap-2 border border-red-900/50 bg-black/60 px-3 py-1 backdrop-blur-sm">
                    <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse shadow-[0_0_8px_red]"></span>
                    <span class="font-mono text-[10px] text-red-500 tracking-[0.2em] font-bold">CARELESS HANDS</span>
                </div>

                <div class="nalani-container mx-auto">
                    <div class="nalani-mask">
                        <div class="nalani-fill"></div>
                        <div class="fire-turbulence"></div>
                    </div>
                </div>

                <div class="font-mono text-orange-100/80 text-xs md:text-sm tracking-widest mt-4 drop-shadow-md">
                    <p class="mb-1">HE'LL COME WITH TRADE</p>
                    <p class="text-orange-500 font-bold text-base md:text-lg">THEN TAKE THE BLADE.</p>
                </div>

                <div class="mobile-hint text-orange-500">[ TAP TO ARM ]</div>

                <a href="#" class="btn-war"
                    onclick="event.stopPropagation(); window.top.location.href = PIXEL_MANIFEST.MATAALA; return false;">
                    ENTER
                </a>
            </div>
        </div>

    </div>

    <!-- Hidden audio element for character song snippets -->
    <audio id="characterAudio" preload="none"></audio>

    <script>
        // --- 1. MOBILE INTERACTION ENGINE ---
        const leftPanel = document.getElementById('leftPanel');
        const rightPanel = document.getElementById('rightPanel');
        const body = document.body;

        function handlePanelTap(selected, other, hoverClass) {
            // DESKTOP: Just handle cursor classes
            if (window.innerWidth > 768) {
                body.classList.remove('hover-left', 'hover-right');
                body.classList.add(hoverClass);
                return;
            }

            // MOBILE: Allow switching between panels at any time
            // Reset States
            selected.classList.remove('inactive');
            other.classList.remove('active');

            // Set New State (Arm the selected panel)
            selected.classList.add('active');
            other.classList.add('inactive');

            // Haptic feedback (Android)
            if (navigator.vibrate) navigator.vibrate(15);
        }

        // Attach Events
        leftPanel.addEventListener('click', (e) => {
            // Ignore if clicking the button
            if (e.target.closest('a')) return;
            handlePanelTap(leftPanel, rightPanel, 'hover-left');
        });

        rightPanel.addEventListener('click', async (e) => {
            if (e.target.closest('a')) return;

            // Trigger NALANI bounce animation
            const nalaniContainer = document.querySelector('.nalani-container');
            if (nalaniContainer) {
                nalaniContainer.classList.remove('bounce');
                // Force reflow to restart animation
                void nalaniContainer.offsetWidth;
                nalaniContainer.classList.add('bounce');
            }

            // Initialize NALANI audio controller if needed
            if (!nalaniAudioController) {
                console.log('Creating NALANI audio controller...');
                const nalaniAudio = document.createElement('audio');
                nalaniAudio.id = 'nalaniAudio';
                nalaniAudio.preload = 'none';
                document.body.appendChild(nalaniAudio);
                nalaniAudioController = new AudioController(nalaniAudio);
            }

            // Select random NALANI track (different from last one if possible)
            let selectedTrack;
            if (nalaniTracks.length > 1) {
                do {
                    selectedTrack = nalaniTracks[Math.floor(Math.random() * nalaniTracks.length)];
                } while (selectedTrack === lastNalaniTrack && nalaniTracks.length > 1);
            } else {
                selectedTrack = nalaniTracks[0];
            }

            lastNalaniTrack = selectedTrack;

            console.log('Playing NALANI:', selectedTrack.text, selectedTrack.url);

            // Play NALANI track
            try {
                await nalaniAudioController.playTrack(selectedTrack.url, 1500);
                console.log('NALANI track started successfully');
            } catch (error) {
                console.error('NALANI playback error:', error);
            }

            // Also handle panel switching
            handlePanelTap(rightPanel, leftPanel, 'hover-right');
        });

        // Desktop Hover Events
        leftPanel.addEventListener('mouseenter', () => body.classList.add('hover-left'));
        leftPanel.addEventListener('mouseleave', () => body.classList.remove('hover-left'));
        rightPanel.addEventListener('mouseenter', () => body.classList.add('hover-right'));
        rightPanel.addEventListener('mouseleave', () => body.classList.remove('hover-right'));

        // --- MOBILE SWIPE DETECTION ---
        let touchStartY = 0;
        let touchEndY = 0;
        const swipeThreshold = 50; // minimum distance for a swipe

        document.addEventListener('touchstart', (e) => {
            touchStartY = e.changedTouches[0].screenY;
        }, { passive: true });

        document.addEventListener('touchend', (e) => {
            if (window.innerWidth > 768) return; // Only on mobile

            touchEndY = e.changedTouches[0].screenY;
            const swipeDistance = touchStartY - touchEndY;

            // Swipe up (to see MATAALA/bottom panel)
            if (swipeDistance > swipeThreshold) {
                handlePanelTap(rightPanel, leftPanel, 'hover-right');
            }
            // Swipe down (to see SILENCE/top panel)
            else if (swipeDistance < -swipeThreshold) {
                handlePanelTap(leftPanel, rightPanel, 'hover-left');
            }
        }, { passive: true });


        // --- 2. VISUALS: CURSOR (Desktop) ---
        const cursor = document.getElementById('cursor');
        document.addEventListener('mousemove', (e) => {
            if (window.innerWidth <= 768) return;
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';

            // Parallax
            const moveX = (e.clientX - window.innerWidth / 2) * 0.02;
            const moveY = (e.clientY - window.innerHeight / 2) * 0.02;
            const bgWar = document.getElementById('bgWar');
            if (bgWar) bgWar.style.transform = `scale(1.1) translate(${-moveX}px, ${-moveY}px)`;
        });


        // --- 4. VISUALS: GLITCH TEXT WITH CHARACTER EASTER EGG ---
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        const title = document.getElementById('glitchTitle');
        const subtitle = document.getElementById('subtitleText'); // "IS THE TRAUMA" subtitle
        const subjectLabel = document.querySelector('.text-gray-500');
        const messageWrapper = document.querySelectorAll('.redacted-wrapper')[1];

        // Audio tracks with character associations - 25 song snippets
        const audioTracks = [
            // ETHEL tracks (25 total) - STATUS: SURVEILLANCE
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "If I second guess he writes the end.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_If_I_second_guess_he_writes_the_end.wav" },
            //{ character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "I rotate fate.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_I_rotate_fate.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "You made a cage for you.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_you_made_a_cage_for_you.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "The pub, that's the vantage.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_The_pub_thats_the_vantage.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Testing their perspectives.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_Testing_their_perspectives.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "So I watched the systems, not the world they sell.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_So_I_watched_the_systems_not_the_world_the_sell.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Note on the bike, ride it.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_Note_on_the_bike_ride_it.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Normal buys the t-shirt.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_Normal_buys_the_t_shirt.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "My father not met, assessed.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_My_father_not_met_assessed.wav" },
            // { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "It back in neutral hue.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_it_back_in_neutral_hue.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Half a block to lose.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_Half_A_block_to_loose.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Gran was a chemist.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_Gran_was_a_chemist.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Face like a window, talk like a screen.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_Face_like_a_window_talk_like_a_screen.wav" },
            //{ character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "AFP number, as if she'd drawn the fuse.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_AFP_number_as_if_shed_drawn_the_fuse.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "They Rewrite You.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_The_rewrite_you.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "I'll stitch the cost.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/ETHEL_Stitch_The_Cost.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Silence = Debt Alive", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/ETHEL_Silence_Keeps_the_debt_alive.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Silence isn't free!", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/ETHEL_silence_isnt_free.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Silence is the warning", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/ETHEL_Silence_is_the_warning.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Frame before it sets.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_Read_the_frame.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Not belief its balance", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_Not%20Belief_Its_balance.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Hero! Killer!", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/ETHEL_Hero_Killer.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Don't light a candle.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/ETHEL_DONT-LIGHT_A_CANDLE.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "See mind blind now.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/ETHEL_See_my_min_blind_now.wav" },
            { character: "ETHEL", subtitle: "CIRCUIT BREAKER", status: "SURVEILLANCE", text: "Truth In Open Air", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Ethel_Truth%20In_Open_Air.wav" },

            // ISLA tracks (18 total) - STATUS: PUBLIC FIGURE
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "I climbed the pit screaming.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Isla_I_climbed_the_pit_screaming.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "This is proof.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/isla_this_is_proof.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "No price too steep.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Isla_no_proce_too_steep.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "I'm split inside.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/isla_Im_split_inside.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "You think you're the gate.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Isla_You_thing_your_the_gate.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "Radio host.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/isla_radio_host.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "Eyes wide I scream.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Isla_Eyes_wide_I_scream.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "I sing the cut, I feed it air, give it back.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/isla_I_sing_the_cut_I_feed_it_air_give_it_back.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "Court Locked Dirt.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Isla_Court_locked_dirt.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "Cant Keep Me Quiet", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Isla_cant_keep_me_quiet.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "Survival is a win", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/ISLA_Survival_Is_A_Win.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "Me? Not his mess!", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Isla_Me_Step_trash.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "Married Banker. Wrong night!!", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/ISLA_Married_Bankers.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "Leave the hinge singing.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Isla_Leave_the_hinge_sining.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "I'm the new crazy!", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Isla_Im_the_new_crazy.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "Clicks like it knows", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Isla_Crosswalk_klicks.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "Inside? passwords!", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Isla_Cookies_cracked_inside_passwords.wav" },
            { character: "ISLA", subtitle: "CATALYST", status: "PUBLIC FIGURE", text: "A mind I knew so well", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Isla_A_Mind_I_knew_so_Well.wav" },

            // DOMINIC tracks (3 total) - STATUS: ESCAPED
            { character: "DOMINIC", subtitle: "CALM MENACE", status: "ESCAPED", text: "Why hold burdens?", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/DOMINIC_Burdens_I_Can_Carry.wav" },
            { character: "DOMINIC", subtitle: "CALM MENACE", status: "ESCAPED", text: "They look at reaction.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/DOMINIC_flag_tour_tone.wav" },
            { character: "DOMINIC", subtitle: "CALM MENACE", status: "ESCAPED", text: "1 omission + 2 suggestions.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/DOMINIC_one_omission_two_suggestions.wav" },

            // WITNESS track (1 total) - STATUS: UNKNOWN
            { character: "WITNESS", subtitle: "WITNESS", status: "UNKNOWN", text: "Casual. Gone.", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/Dominic_Casual_Gone.wav" },

            // KINLEY track (1 total) - STATUS: COMPROMISED
            { character: "KINLEY", subtitle: "POWER BROKER", status: "COMPROMISED", text: "Guilt Money", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/KINLEY_Guilt_Money.wav" },

            // STICKY track (1 total) - STATUS: ACTIVE
            { character: "STICKY", subtitle: "TRUTH SEEKER", status: "ACTIVE", text: "Systems broke. Fix it", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/STICKY_Systems_broke_fix_it.wav" }
        ];

        // NALANI tracks (4 total) - Play randomly when clicking NALANI image
        const nalaniTracks = [
            { text: "Storm unseen", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/NALANI_Storm_unseen.wav" },
            { text: "I questioned proud", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.de/audio/NALANI_I_questioned_proud.wav" },
            { text: "Out past the reef", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/NALANI_Out_past_the_reef.wav" },
            { text: "Maps were drawn", url: "https://pub-111e813bd5634cd8a9ecdd3d5c2a0916.r2.dev/audio/NALANI_Maps_were_drawn.wav" }
        ];

        // Character subtitle mapping for SILENCE (no audio)
        const characterSubtitles = {
            "SILENCE": "IS THE TRAUMA",
            "ETHEL": "CIRCUIT BREAKER",
            "ISLA": "CATALYST",
            "DOMINIC": "CALM MENACE",
            "DOM'S HENCHMAN": "WITNESS"
        };

        // Track last selected to prevent consecutive duplicates
        let lastSelectedCharacter = null;
        let lastSelectedMessage = null;
        let lastSelectedTrack = null;

        // Audio Controller with fade effects
        class AudioController {
            constructor(audioElement = null) {
                this.audio = audioElement || document.getElementById('characterAudio');
                this.isPlaying = false;
                this.currentFade = null;
            }

            async playTrack(url, fadeInDuration = 2000) {
                // Stop any ongoing fade
                if (this.currentFade) {
                    clearInterval(this.currentFade);
                    this.currentFade = null;
                }

                // Fade out current track if playing
                if (this.isPlaying) {
                    await this.fadeOut(300);
                }

                // Load and play new track
                this.audio.src = url;
                this.audio.volume = 0;

                try {
                    await this.audio.play();
                    this.isPlaying = true;

                    // Fade in
                    await this.fadeIn(fadeInDuration);
                } catch (error) {
                    console.error('Audio playback failed:', error);
                    this.isPlaying = false;
                }
            }

            fadeIn(duration) {
                return new Promise((resolve) => {
                    const steps = 20;
                    const stepDuration = duration / steps;
                    const volumeIncrement = 1 / steps;
                    let currentStep = 0;

                    this.currentFade = setInterval(() => {
                        currentStep++;
                        this.audio.volume = Math.min(currentStep * volumeIncrement, 1);

                        if (currentStep >= steps) {
                            clearInterval(this.currentFade);
                            this.currentFade = null;
                            this.audio.volume = 1;
                            resolve();
                        }
                    }, stepDuration);
                });
            }

            fadeOut(duration) {
                return new Promise((resolve) => {
                    const steps = 20;
                    const stepDuration = duration / steps;
                    const startVolume = this.audio.volume;
                    const volumeDecrement = startVolume / steps;
                    let currentStep = 0;

                    this.currentFade = setInterval(() => {
                        currentStep++;
                        this.audio.volume = Math.max(startVolume - (currentStep * volumeDecrement), 0);

                        if (currentStep >= steps) {
                            clearInterval(this.currentFade);
                            this.currentFade = null;
                            this.audio.pause();
                            this.audio.volume = 0;
                            this.isPlaying = false;
                            resolve();
                        }
                    }, stepDuration);
                });
            }

            stop() {
                if (this.currentFade) {
                    clearInterval(this.currentFade);
                    this.currentFade = null;
                }
                this.audio.pause();
                this.audio.currentTime = 0;
                this.audio.volume = 0;
                this.isPlaying = false;
            }
        }

        // Initialize audio controller
        const audioController = new AudioController();

        // NALANI audio system
        let nalaniAudioController = null;
        let lastNalaniTrack = null;

        // Modify handlePanelTap to stop appropriate audio when switching panels
        const originalHandlePanelTap = handlePanelTap;
        handlePanelTap = function (active, other, hoverClass) {
            // Stop character audio when switching to NALANI (right panel)
            if (active === rightPanel && audioController.isPlaying) {
                audioController.stop();
            }

            // Stop NALANI audio when switching back to SILENCE (left panel)
            if (active === leftPanel && nalaniAudioController && nalaniAudioController.isPlaying) {
                nalaniAudioController.stop();
            }

            // Call original function
            originalHandlePanelTap(active, other, hoverClass);
        };

        // Auto-reset to SILENCE when track ends
        const audio = document.getElementById('characterAudio');
        audio.addEventListener('ended', () => {
            // Reset to SILENCE
            title.textContent = 'SILENCE';
            subtitle.textContent = 'IS THE TRAUMA';

            const subjectWrapper = document.querySelectorAll('.redacted-wrapper')[0];
            const subjectText = subjectWrapper.querySelector('span:not(.redacted-bar)') || subjectWrapper.childNodes[0];
            if (subjectText) {
                subjectText.textContent = 'SILENCE';
            }

            const messageText = messageWrapper.querySelector('span:not(.redacted-bar)') || messageWrapper.childNodes[0];
            if (messageText) {
                messageText.textContent = '"Silence isn\'t absence."';
            }

            // Remove all vibe classes
            leftPanel.classList.remove('vibe-isla', 'vibe-ethel', 'vibe-dominic', 'vibe-witness', 'vibe-kinley', 'vibe-sticky');

            // Mark character as inactive to allow ambient glitch
            isCharacterActive = false;

            // Reset tracking
            lastSelectedTrack = null;
            lastSelectedCharacter = null;
            lastSelectedMessage = null;
        });

        // Ambient glitch effect - runs automatically every 5-8 seconds
        let ambientGlitchTimeout = null;
        let isGlitching = false;
        let isCharacterActive = false; // Track if a character is currently displayed

        function scheduleNextGlitch() {
            // Random interval between 5-8 seconds
            const nextGlitchDelay = 5000 + Math.random() * 3000;

            ambientGlitchTimeout = setTimeout(() => {
                // Only glitch if no character is active and not already glitching
                if (!isGlitching && !isCharacterActive && title.textContent === 'SILENCE') {
                    doAmbientGlitch();
                }
                scheduleNextGlitch();
            }, nextGlitchDelay);
        }

        function doAmbientGlitch() {
            const currentText = title.textContent;
            const textLength = currentText.length;
            let iteration = 0;
            const maxIterations = 8 + Math.floor(Math.random() * 5); // 8-12 frames

            const glitchInterval = setInterval(() => {
                if (iteration < maxIterations) {
                    // Random glitch patterns
                    const glitchType = Math.floor(Math.random() * 3);

                    if (glitchType === 0) {
                        // Full shuffle
                        let shuffled = '';
                        for (let i = 0; i < textLength; i++) {
                            shuffled += letters[Math.floor(Math.random() * letters.length)];
                        }
                        title.textContent = shuffled;
                    } else if (glitchType === 1) {
                        // Partial glitch - only some letters
                        title.textContent = currentText
                            .split('')
                            .map(char => Math.random() > 0.5 ? char : letters[Math.floor(Math.random() * letters.length)])
                            .join('');
                    } else {
                        // Position shift glitch
                        const shift = Math.floor(Math.random() * 3) - 1;
                        title.textContent = currentText
                            .split('')
                            .map((char, i) => {
                                const newIndex = (i + shift + textLength) % textLength;
                                return currentText[newIndex];
                            })
                            .join('');
                    }
                    iteration++;
                } else {
                    // Restore original text
                    clearInterval(glitchInterval);
                    title.textContent = currentText;
                    isGlitching = false;
                }
            }, 60);

            isGlitching = true;
        }

        // Start ambient glitch cycle
        scheduleNextGlitch();

        // Trigger glitch on hover (desktop) or tap (mobile)
        function triggerGlitch() {
            let iteration = 0;

            // Select random track (excluding last selected)
            const availableTracks = lastSelectedTrack
                ? audioTracks.filter(track => track !== lastSelectedTrack)
                : audioTracks;

            const selectedTrack = availableTracks[Math.floor(Math.random() * availableTracks.length)];
            const selectedName = selectedTrack.character;
            const selectedSubtitle = selectedTrack.subtitle;
            const selectedMessage = selectedTrack.text;
            const selectedUrl = selectedTrack.url;
            const selectedStatus = selectedTrack.status;

            // Update tracking
            lastSelectedTrack = selectedTrack;
            lastSelectedCharacter = selectedName;
            lastSelectedMessage = selectedMessage;

            // Apply character-specific vibe
            leftPanel.classList.remove('vibe-isla', 'vibe-ethel', 'vibe-dominic', 'vibe-witness', 'vibe-kinley', 'vibe-sticky');
            if (selectedName === 'ISLA') {
                leftPanel.classList.add('vibe-isla');
            } else if (selectedName === 'ETHEL') {
                leftPanel.classList.add('vibe-ethel');
            } else if (selectedName === 'DOMINIC') {
                leftPanel.classList.add('vibe-dominic');
            } else if (selectedName === 'WITNESS') {
                leftPanel.classList.add('vibe-witness');
            } else if (selectedName === 'KINLEY') {
                leftPanel.classList.add('vibe-kinley');
            } else if (selectedName === 'STICKY') {
                leftPanel.classList.add('vibe-sticky');
            }

            // Mark character as active to prevent ambient glitch
            isCharacterActive = true;

            clearInterval(title.interval);

            title.interval = setInterval(() => {
                const shuffledText = selectedName
                    .split("")
                    .map((letter, index) => {
                        if (index < iteration) return selectedName[index];
                        return letters[Math.floor(Math.random() * letters.length)];
                    })
                    .join("");

                // Cap at exact character name length to prevent blowout
                title.innerText = shuffledText.substring(0, selectedName.length);

                if (iteration >= selectedName.length) {
                    clearInterval(title.interval);

                    // Update the STATUS field with character status (not name)
                    const subjectWrapper = document.querySelectorAll('.redacted-wrapper')[0];
                    const subjectText = subjectWrapper.querySelector('span:not(.redacted-bar)') || subjectWrapper.childNodes[0];
                    if (subjectText) {
                        subjectText.textContent = selectedStatus;
                    }

                    // Update the MESSAGE with track text
                    const messageText = messageWrapper.querySelector('span:not(.redacted-bar)') || messageWrapper.childNodes[0];
                    if (messageText) {
                        messageText.textContent = `"${selectedMessage}"`;
                    }

                    // Update subtitle with character-specific text
                    subtitle.textContent = selectedSubtitle;

                    // Play audio track with fade in
                    console.log('Playing track:', selectedName, selectedMessage, selectedUrl);
                    audioController.playTrack(selectedUrl, 500);
                }
                iteration += 1 / 2;
            }, 30);
        }

        // Only trigger on click, not on hover
        leftPanel.addEventListener('click', triggerGlitch);

        // Debug: Check if audio element exists
        console.log('Audio element:', document.getElementById('characterAudio'));
        console.log('Audio controller initialized:', audioController);

    </script>

</body>

</html>