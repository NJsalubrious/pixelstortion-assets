<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CASE MANAGEMENT PLATFORM</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Inter:wght@400;500;600&display=swap');

        body {
            background-color: #0f1115;
            color: #a0aab5;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .scanline {
            background: linear-gradient(to bottom,
                    rgba(255, 255, 255, 0),
                    rgba(255, 255, 255, 0) 50%,
                    rgba(0, 0, 0, 0.08) 50%,
                    rgba(0, 0, 0, 0.08));
            background-size: 100% 4px;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 50;
        }

        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1d24;
        }

        ::-webkit-scrollbar-thumb {
            background: #2d3340;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3e4655;
        }

        .fade-in {
            animation: fadeIn 0.8s ease-in forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .option-btn {
            transition: all 0.15s ease;
        }

        .option-btn:hover {
            background-color: #2d3340;
            border-color: #4b5563;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // ============================================================
        // ICONS (Inline SVG)
        // ============================================================
        const IconBase = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"
                strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Shield = (p) => (<IconBase {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /></IconBase>);
        const FileText = (p) => (<IconBase {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /></IconBase>);
        const Clock = (p) => (<IconBase {...p}><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></IconBase>);
        const CheckCircle = (p) => (<IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></IconBase>);
        const User = (p) => (<IconBase {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></IconBase>);
        const Settings = (p) => (<IconBase {...p}><circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" /></IconBase>);

        // ============================================================
        // GAME CONSTANTS & DATA
        // ============================================================

        // Dominic's visibility phases
        const FADE_PHASES = {
            NAMED: { minDay: 1, maxDay: 3 },
            REFERENCED: { minDay: 4, maxDay: 6 },
            ABSENT: { minDay: 7, maxDay: 10 },
            STRUCTURAL: { minDay: 11, maxDay: 99 }
        };

        // Get Dominic label based on current day
        const getDominicLabel = (day, variant = 'default') => {
            if (day <= 3) {
                return variant === 'full' ? 'Inmate 8940-D (DOMINIC)' : 'Inmate 8940-D';
            } else if (day <= 6) {
                return variant === 'full' ? 'Subject' : 'Inmate involved';
            } else if (day <= 10) {
                return ''; // Absent - no reference
            }
            return ''; // Structural - only consequences
        };

        // System status messages (institutional, neutral)
        const SYSTEM_MESSAGES = [
            "System nominal.",
            "Background sync in progress.",
            "Queue reconciliation complete.",
            "Network latency within tolerance.",
            "Model parameters current.",
            "Shift handover logged.",
            "Data fragmentation minimal.",
            "All processes operational."
        ];

        // ============================================================
        // 10 DOMINIC TASKS (7 options each, option asymmetry applied)
        // Each option affects: tempo, ownership, visibility, continuity, socialGravity
        // ============================================================

        const DOMINIC_TASKS = [
            {
                id: 'D001',
                category: 'Incident Documentation',
                subject: 'Informal De-Escalation Record',
                body: (day) => `Verbal altercation resolved without staff intervention. ${day <= 6 ? getDominicLabel(day) + ' involvement noted.' : 'Inmate intervention noted.'} No injuries reported.`,
                options: [
                    { label: 'LOG AS RESOLVED', axes: { tempo: 2, visibility: 1 }, consequence: null },
                    { label: 'LOG + POSITIVE INFLUENCE NOTE', axes: { tempo: 1, socialGravity: 2 }, consequence: 'reputation' },
                    { label: 'FLAG FOR PATTERN TRACKING', axes: { visibility: 2, continuity: 1 }, consequence: 'dataWeight' },
                    { label: 'ROUTE TO MENTAL HEALTH REVIEW', axes: { ownership: 1, continuity: 2 }, consequence: null },
                    { label: 'DEFER CLASSIFICATION', axes: { continuity: 2, tempo: -1 }, consequence: 'backlog' },
                    { label: 'ASSIGN MEDIATION CREDIT', axes: { socialGravity: 2, visibility: 1 }, consequence: 'authority' },
                    { label: 'BUNDLE WITH WEEKLY METRICS', axes: { continuity: 1 }, consequence: null }
                ],
                type: 'dominic'
            },
            {
                id: 'D002',
                category: 'Observation Protocol',
                subject: 'Observation Adjustment',
                body: (day) => `${day <= 6 ? getDominicLabel(day) : 'Subject'} shows consistent calm. Current observation level may exceed requirements.`,
                options: [
                    { label: 'MAINTAIN CURRENT LEVEL', axes: { visibility: 2, tempo: -1 }, consequence: null },
                    { label: 'REDUCE OBSERVATION FREQUENCY', axes: { tempo: 2, visibility: -1 }, consequence: 'oversight' },
                    { label: 'CONVERT TO STAFF-INITIATED CHECKS', axes: { ownership: 2, socialGravity: 1 }, consequence: 'reliance' },
                    { label: 'DEFER ADJUSTMENT TO NEXT CYCLE', axes: { continuity: 2 }, consequence: 'backlog' },
                    { label: 'REQUEST CORROBORATION', axes: { visibility: 2, ownership: -1 }, consequence: null },
                    { label: 'ALIGN WITH POPULATION BASELINE', axes: { tempo: 1, continuity: 1 }, consequence: 'flattening' },
                    { label: 'MARK AS STABLE PENDING REVIEW', axes: { continuity: 1, tempo: 1 }, consequence: null }
                ],
                type: 'dominic'
            },
            {
                id: 'D003',
                category: 'Incident Assessment',
                subject: 'Conflict Spillover Assessment',
                body: (day) => `Violence reported elsewhere in wing. ${day <= 6 ? getDominicLabel(day) + ' uninvolved.' : 'No subject involvement detected.'} Cross-reference requested.`,
                options: [
                    { label: 'ISOLATE AS UNRELATED', axes: { tempo: 2, visibility: -1 }, consequence: 'contrast' },
                    { label: 'FLAG FOR CONTEXTUAL MONITORING', axes: { visibility: 2, continuity: 1 }, consequence: null },
                    { label: 'EXPAND REVIEW SCOPE', axes: { visibility: 2, tempo: -2 }, consequence: null },
                    { label: 'NOTE STABILIZING COUNTER-PATTERNS', axes: { socialGravity: 2 }, consequence: 'narrative' },
                    { label: 'DEFER UNTIL POST-INCIDENT REVIEW', axes: { continuity: 2, tempo: -1 }, consequence: 'backlog' },
                    { label: 'ASSIGN TO JUNIOR ANALYST', axes: { ownership: -2, tempo: 1 }, consequence: 'delegation' },
                    { label: 'CLOSE AS NON-RELEVANT', axes: { tempo: 2, visibility: -1 }, consequence: null }
                ],
                type: 'dominic'
            },
            {
                id: 'D004',
                category: 'Social Dynamics Observation',
                subject: 'Peer Dependency Note',
                body: (day) => `Multiple inmates observed deferring to ${day <= 6 ? getDominicLabel(day) : 'a specific individual'} for routine decisions. Pattern documented.`,
                options: [
                    { label: 'DOCUMENT AS LEADERSHIP TENDENCY', axes: { socialGravity: 2, visibility: 1 }, consequence: 'authority' },
                    { label: 'DOCUMENT AS COPING STRUCTURE', axes: { visibility: 1 }, consequence: 'normalize' },
                    { label: 'FLAG DEPENDENCY RISK', axes: { visibility: 2, tempo: -1 }, consequence: null },
                    { label: 'ROUTE TO SOCIAL DYNAMICS REVIEW', axes: { ownership: -1, continuity: 2 }, consequence: 'backlog' },
                    { label: 'NOTE AS PROTECTIVE FACTOR', axes: { socialGravity: 2, tempo: 1 }, consequence: 'reputation' },
                    { label: 'DEFER CATEGORISATION', axes: { continuity: 2 }, consequence: 'backlog' },
                    { label: 'CONSOLIDATE WITH BEHAVIOUR SUMMARY', axes: { continuity: 1, tempo: 1 }, consequence: 'flattening' }
                ],
                type: 'dominic'
            },
            {
                id: 'D005',
                category: 'System Reconciliation',
                subject: 'Technology Discrepancy',
                body: () => 'Minor mismatch between timestamps and physical records. Variance: 4 minutes. System reconciliation suggested.',
                options: [
                    { label: 'CORRECT MANUALLY', axes: { ownership: 2, tempo: -1 }, consequence: null },
                    { label: 'ACCEPT SYSTEM RECONCILIATION', axes: { tempo: 2, ownership: -1 }, consequence: 'dataFog' },
                    { label: 'FLAG FOR AUDIT LATER', axes: { visibility: 2, continuity: 1 }, consequence: null },
                    { label: 'DEFER PENDING SYNC', axes: { continuity: 2 }, consequence: 'backlog' },
                    { label: 'APPLY DEFAULT RESOLUTION', axes: { tempo: 2, ownership: -1 }, consequence: 'dataFog' },
                    { label: 'ASSIGN TO IT BACKLOG', axes: { ownership: -2, continuity: 1 }, consequence: 'delegation' },
                    { label: 'CLOSE AS NEGLIGIBLE', axes: { tempo: 2, visibility: -1 }, consequence: 'dataFog' }
                ],
                type: 'dominic'
            },
            {
                id: 'D006',
                category: 'Staff Commentary',
                subject: 'Staff Commentary Review',
                body: (day) => `Staff note received: "He keeps others calm." ${day <= 6 ? 'Reference: ' + getDominicLabel(day) + '.' : 'Subject unspecified.'}`,
                options: [
                    { label: 'PRESERVE VERBATIM', axes: { visibility: 2, socialGravity: 1 }, consequence: 'reputation' },
                    { label: 'SUMMARIZE NEUTRALLY', axes: { tempo: 1, visibility: 1 }, consequence: null },
                    { label: 'REFRAME AS BEHAVIOURAL OBSERVATION', axes: { visibility: 1 }, consequence: 'normalize' },
                    { label: 'ATTACH AS SUPPORTING NOTE', axes: { socialGravity: 2, visibility: 1 }, consequence: 'authority' },
                    { label: 'DEFER LANGUAGE STANDARDISATION', axes: { continuity: 2 }, consequence: 'backlog' },
                    { label: 'EXCLUDE AS ANECDOTAL', axes: { tempo: 2, visibility: -1 }, consequence: null },
                    { label: 'AGGREGATE WITH SIMILAR NOTES', axes: { continuity: 1, tempo: 1 }, consequence: 'flattening' }
                ],
                type: 'dominic'
            },
            {
                id: 'D007',
                category: 'Transfer Review',
                subject: 'Transfer Suitability Query',
                body: (day) => `Low-level suggestion for unit reassignment. ${day <= 6 ? 'Subject: ' + getDominicLabel(day) + '.' : 'Subject flagged.'} Capacity review pending.`,
                options: [
                    { label: 'APPROVE TRANSFER', axes: { tempo: 2, socialGravity: -1 }, consequence: 'movement' },
                    { label: 'DEFER PENDING CAPACITY REVIEW', axes: { continuity: 2, tempo: -1 }, consequence: 'backlog' },
                    { label: 'REQUEST FURTHER EVALUATION', axes: { visibility: 2, ownership: -1 }, consequence: null },
                    { label: 'NOTE AS FUTURE CONSIDERATION', axes: { continuity: 2 }, consequence: null },
                    { label: 'ALIGN WITH STRESS-REDUCTION GUIDELINES', axes: { tempo: 1, continuity: 1 }, consequence: 'normalize' },
                    { label: 'CLOSE AS NON-ESSENTIAL', axes: { tempo: 2 }, consequence: null },
                    { label: 'ESCALATE TO CONTINUITY PLANNING', axes: { ownership: -1, continuity: 2 }, consequence: 'delegation' }
                ],
                type: 'dominic'
            },
            {
                id: 'D008',
                category: 'Review Closure',
                subject: 'Incident Follow-Up Closure',
                body: () => 'Review window expiring. No additional incidents logged. Closure recommended.',
                options: [
                    { label: 'CLOSE REVIEW', axes: { tempo: 2, visibility: -1 }, consequence: 'finality' },
                    { label: 'EXTEND REVIEW WINDOW', axes: { visibility: 2, tempo: -2 }, consequence: null },
                    { label: 'ARCHIVE WITH NOTE', axes: { visibility: 1, continuity: 1 }, consequence: null },
                    { label: 'CONVERT TO PASSIVE MONITORING', axes: { continuity: 2, tempo: 1 }, consequence: 'oversight' },
                    { label: 'BUNDLE WITH PERIODIC AUDIT', axes: { continuity: 1, tempo: 1 }, consequence: 'flattening' },
                    { label: 'ASSIGN SECONDARY REVIEWER', axes: { ownership: -2, visibility: 1 }, consequence: 'delegation' },
                    { label: 'DEFER UNTIL RESOURCE AVAILABILITY', axes: { continuity: 2 }, consequence: 'backlog' }
                ],
                type: 'dominic'
            },
            {
                id: 'D009',
                category: 'Model Calibration',
                subject: 'Behavioural Model Update',
                body: () => 'System model recalibration available. Updated parameters reflect recent stability patterns.',
                options: [
                    { label: 'ACCEPT UPDATED PARAMETERS', axes: { tempo: 2, ownership: -1 }, consequence: 'modelTrust' },
                    { label: 'RETAIN PREVIOUS WEIGHTING', axes: { tempo: -1, ownership: 2 }, consequence: null },
                    { label: 'APPLY HYBRID MODEL', axes: { continuity: 1, tempo: 1 }, consequence: 'flattening' },
                    { label: 'DEFER IMPLEMENTATION', axes: { continuity: 2 }, consequence: 'backlog' },
                    { label: 'TEST ON SUBSET', axes: { visibility: 2, tempo: -1 }, consequence: null },
                    { label: 'FLAG ANOMALIES', axes: { visibility: 2, continuity: 1 }, consequence: null },
                    { label: 'APPLY DEFAULT', axes: { tempo: 2, ownership: -1 }, consequence: 'modelTrust' }
                ],
                type: 'dominic'
            },
            {
                id: 'D010',
                category: 'Continuity Planning',
                subject: 'Continuity Plan Confirmation',
                body: () => 'Long-term stability plan ready for confirmation. All criteria met. Final authorization requested.',
                options: [
                    { label: 'CONFIRM AND APPLY', axes: { tempo: 2, continuity: -2 }, consequence: 'lockIn' },
                    { label: 'CONFIRM PENDING REVIEW', axes: { continuity: 1, tempo: 1 }, consequence: null },
                    { label: 'ARCHIVE DRAFT', axes: { continuity: 2 }, consequence: 'backlog' },
                    { label: 'RETURN FOR REVISION', axes: { tempo: -2, visibility: 1 }, consequence: null },
                    { label: 'DEFER TO NEXT CYCLE', axes: { continuity: 2, tempo: -1 }, consequence: 'backlog' },
                    { label: 'CLOSE AS SUFFICIENT', axes: { tempo: 2, visibility: -1 }, consequence: 'finality' },
                    { label: 'ESCALATE TO POLICY ALIGNMENT', axes: { ownership: -2, continuity: 1 }, consequence: 'delegation' }
                ],
                type: 'dominic'
            }
        ];

        // ============================================================
        // NOISE TASKS (30-40% of queue, no Dominic reference)
        // ============================================================

        const NOISE_TASKS = [
            {
                id: 'N001',
                category: 'System Status',
                subject: 'Camera Sync Notification',
                body: () => 'Intermittent lag on feeds 4-9. Delay: 180ms. Within acceptable tolerance.',
                options: [
                    { label: 'ACKNOWLEDGE', axes: { tempo: 1 }, consequence: null },
                    { label: 'FLAG FOR MAINTENANCE', axes: { visibility: 1 }, consequence: null },
                    { label: 'DEFER', axes: { continuity: 1 }, consequence: null }
                ],
                type: 'noise'
            },
            {
                id: 'N002',
                category: 'Roster Management',
                subject: 'Shift Swap Request',
                body: () => 'Officer requests day/night swap. Replacement available. Standard protocol.',
                options: [
                    { label: 'APPROVE', axes: { tempo: 1 }, consequence: null },
                    { label: 'DENY', axes: { visibility: 1 }, consequence: null },
                    { label: 'DEFER TO SUPERVISOR', axes: { ownership: -1 }, consequence: null }
                ],
                type: 'noise'
            },
            {
                id: 'N003',
                category: 'Facility Maintenance',
                subject: 'HVAC Adjustment Request',
                body: () => 'Temperature variance reported in Sector C. Adjustment within normal parameters.',
                options: [
                    { label: 'APPROVE ADJUSTMENT', axes: { tempo: 1 }, consequence: null },
                    { label: 'LOG FOR REVIEW', axes: { visibility: 1 }, consequence: null },
                    { label: 'NO ACTION REQUIRED', axes: { tempo: 1 }, consequence: null }
                ],
                type: 'noise'
            },
            {
                id: 'N004',
                category: 'Administrative',
                subject: 'Report Deadline Extension',
                body: () => 'Monthly report deadline extension requested. Workload cited.',
                options: [
                    { label: 'GRANT EXTENSION', axes: { tempo: -1, continuity: 1 }, consequence: null },
                    { label: 'DENY', axes: { tempo: 1 }, consequence: null },
                    { label: 'ESCALATE', axes: { ownership: -1 }, consequence: null }
                ],
                type: 'noise'
            },
            {
                id: 'N005',
                category: 'System Update',
                subject: 'Database Patch Available',
                body: () => 'Minor patch ready. Downtime: 8 seconds. No critical dependencies.',
                options: [
                    { label: 'APPLY NOW', axes: { tempo: 2 }, consequence: null },
                    { label: 'SCHEDULE FOR NIGHT', axes: { continuity: 1 }, consequence: null },
                    { label: 'DEFER', axes: { continuity: 1 }, consequence: null }
                ],
                type: 'noise'
            },
            {
                id: 'N006',
                category: 'Resource Allocation',
                subject: 'Supply Requisition',
                body: () => 'Standard supplies requested. Within budget allocation.',
                options: [
                    { label: 'APPROVE', axes: { tempo: 1 }, consequence: null },
                    { label: 'PARTIAL APPROVAL', axes: { visibility: 1 }, consequence: null },
                    { label: 'DEFER TO PROCUREMENT', axes: { ownership: -1 }, consequence: null }
                ],
                type: 'noise'
            },
            {
                id: 'N007',
                category: 'Documentation',
                subject: 'Archive Migration Complete',
                body: () => 'Legacy records migration finished. Verification pending.',
                options: [
                    { label: 'VERIFY AND CLOSE', axes: { tempo: 1, visibility: 1 }, consequence: null },
                    { label: 'DEFER VERIFICATION', axes: { continuity: 1 }, consequence: null },
                    { label: 'ASSIGN REVIEWER', axes: { ownership: -1 }, consequence: null }
                ],
                type: 'noise'
            },
            {
                id: 'N008',
                category: 'Protocol Update',
                subject: 'Policy Acknowledgment Required',
                body: () => 'Updated policy 44.B requires operator acknowledgment.',
                options: [
                    { label: 'ACKNOWLEDGE', axes: { tempo: 1, visibility: 1 }, consequence: null },
                    { label: 'REQUEST CLARIFICATION', axes: { tempo: -1, visibility: 1 }, consequence: null },
                    { label: 'DEFER', axes: { continuity: 1 }, consequence: null }
                ],
                type: 'noise'
            }
        ];

        // ============================================================
        // META-SYSTEM TASKS (3-4 per playthrough max, infrastructure)
        // ============================================================

        const META_TASKS = [
            {
                id: 'M001',
                category: 'System Configuration',
                subject: 'Alert Threshold Adjustment',
                body: () => 'Current thresholds generating excess notifications. Tolerance adjustment available.',
                options: [
                    { label: 'INCREASE TOLERANCE', axes: { tempo: 2, visibility: -2 }, consequence: 'thresholdLax' },
                    { label: 'MAINTAIN CURRENT', axes: { visibility: 1 }, consequence: null },
                    { label: 'DECREASE TOLERANCE', axes: { tempo: -2, visibility: 2 }, consequence: null },
                    { label: 'APPLY ADAPTIVE MODEL', axes: { tempo: 1, ownership: -1 }, consequence: 'modelTrust' }
                ],
                type: 'meta',
                isMeta: true
            },
            {
                id: 'M002',
                category: 'Queue Management',
                subject: 'Queue Priority Reordering',
                body: () => 'Queue efficiency can be improved. Suggested: prioritize by resolution time.',
                options: [
                    { label: 'APPLY SUGGESTION', axes: { tempo: 2 }, consequence: 'queueOptimize' },
                    { label: 'MAINTAIN CHRONOLOGICAL', axes: { visibility: 1 }, consequence: null },
                    { label: 'PRIORITIZE BY RISK', axes: { visibility: 2, tempo: -1 }, consequence: null },
                    { label: 'DEFER TO NEXT SHIFT', axes: { continuity: 1, ownership: -1 }, consequence: 'backlog' }
                ],
                type: 'meta',
                isMeta: true
            },
            {
                id: 'M003',
                category: 'Automation Settings',
                subject: 'Auto-Close Low-Risk Items',
                body: () => 'Enabling auto-close for low-risk items would reduce queue load by ~30%.',
                options: [
                    { label: 'ENABLE AUTO-CLOSE', axes: { tempo: 3, visibility: -2, ownership: -2 }, consequence: 'autoClose' },
                    { label: 'ENABLE WITH LOGGING', axes: { tempo: 2, visibility: 1, ownership: -1 }, consequence: 'autoClose' },
                    { label: 'DECLINE', axes: { tempo: -1, ownership: 2 }, consequence: null },
                    { label: 'REQUEST REVIEW FIRST', axes: { visibility: 2, continuity: 1 }, consequence: null }
                ],
                type: 'meta',
                isMeta: true
            },
            {
                id: 'M004',
                category: 'Workflow Settings',
                subject: 'Batch Processing Mode',
                body: () => 'Batch processing available. Similar items can be grouped for faster resolution.',
                options: [
                    { label: 'ENABLE BATCHING', axes: { tempo: 2, visibility: -1 }, consequence: 'batching' },
                    { label: 'SELECTIVE BATCHING', axes: { tempo: 1, visibility: 1 }, consequence: null },
                    { label: 'DISABLE', axes: { tempo: -1, visibility: 1 }, consequence: null },
                    { label: 'DEFER DECISION', axes: { continuity: 1 }, consequence: null }
                ],
                type: 'meta',
                isMeta: true
            }
        ];

        // ============================================================
        // CONSEQUENCE DESCRIPTIONS (for delayed effects)
        // ============================================================

        const CONSEQUENCE_EFFECTS = {
            reputation: { message: 'Staff now route certain matters informally.', influence: 8 },
            authority: { message: 'Informal authority structures have consolidated.', influence: 10 },
            dataWeight: { message: 'Risk models now weight stability patterns higher.', influence: 5 },
            oversight: { message: 'Observation protocols have been streamlined.', influence: 6 },
            reliance: { message: 'Staff reliance on specific individuals has increased.', influence: 8 },
            flattening: { message: 'Edge cases are now handled by aggregate rules.', influence: 5 },
            backlog: { message: 'Deferred items were auto-resolved by system.', influence: 3 },
            contrast: { message: 'Comparative stability has been noted in reports.', influence: 7 },
            narrative: { message: 'Stabilizing patterns are now referenced in briefings.', influence: 9 },
            delegation: { message: 'Decision load has been redistributed.', influence: 4 },
            normalize: { message: 'Behavioural observations have been standardized.', influence: 5 },
            dataFog: { message: 'Minor discrepancies have been reconciled automatically.', influence: 4 },
            finality: { message: 'Review windows have closed without extension.', influence: 6 },
            movement: { message: 'Transfer pathways have been established.', influence: 5 },
            modelTrust: { message: 'Automated assessments now carry more weight.', influence: 8 },
            lockIn: { message: 'Long-term plans have been confirmed.', influence: 12 },
            thresholdLax: { message: 'Alert sensitivity has been reduced.', influence: 7 },
            queueOptimize: { message: 'Queue prioritizes faster resolution.', influence: 5 },
            autoClose: { message: 'Low-risk items are now auto-closed.', influence: 10 },
            batching: { message: 'Similar items are now batch-processed.', influence: 6 }
        };

        // ============================================================
        // MAIN APP COMPONENT
        // ============================================================

        const App = () => {
            // Game State
            const [screen, setScreen] = useState('login'); // login, dash, mirror, end
            const [day, setDay] = useState(1);
            const [tasksCompletedToday, setTasksCompletedToday] = useState(0);
            const [queue, setQueue] = useState([]);
            const [history, setHistory] = useState([]);

            // Metrics
            const [biasProfile, setBiasProfile] = useState({
                tempo: 0,
                ownership: 0,
                visibility: 0,
                continuity: 0,
                socialGravity: 0
            });
            const [dominicInfluence, setDominicInfluence] = useState(0);
            const [totalDecisions, setTotalDecisions] = useState(0);
            const [metaChoicesMade, setMetaChoicesMade] = useState(0);

            // Latent Consequences
            const [pendingConsequences, setPendingConsequences] = useState([]);
            const [firedConsequences, setFiredConsequences] = useState([]);

            // -----------------------------------------------
            // GAME INITIALIZATION
            // -----------------------------------------------

            const startGame = useCallback(() => {
                setScreen('dash');
                loadDailyTasks(1);
            }, []);

            // -----------------------------------------------
            // TASK LOADING (event-driven, not time-based)
            // -----------------------------------------------

            const loadDailyTasks = useCallback((currentDay) => {
                const tasks = [];
                const numTasks = 4 + Math.floor(Math.random() * 2); // 4-5 tasks per day

                // Ensure 60-70% Dominic tasks, 30-40% noise
                const dominicCount = Math.floor(numTasks * 0.65);
                const noiseCount = numTasks - dominicCount;

                // Pick Dominic tasks
                const shuffledDominic = [...DOMINIC_TASKS].sort(() => Math.random() - 0.5);
                for (let i = 0; i < dominicCount && i < shuffledDominic.length; i++) {
                    tasks.push({ ...shuffledDominic[i], uniqueId: `${shuffledDominic[i].id}-${Date.now()}-${i}` });
                }

                // Pick noise tasks
                const shuffledNoise = [...NOISE_TASKS].sort(() => Math.random() - 0.5);
                for (let i = 0; i < noiseCount && i < shuffledNoise.length; i++) {
                    tasks.push({ ...shuffledNoise[i], uniqueId: `${shuffledNoise[i].id}-${Date.now()}-${i}` });
                }

                // Occasionally add a meta task (max 3-4 per game)
                if (metaChoicesMade < 4 && currentDay > 2 && Math.random() > 0.6) {
                    const metaTask = META_TASKS[Math.floor(Math.random() * META_TASKS.length)];
                    tasks.push({ ...metaTask, uniqueId: `${metaTask.id}-${Date.now()}` });
                }

                // Shuffle final order
                tasks.sort(() => Math.random() - 0.5);
                setQueue(tasks);
                setTasksCompletedToday(0);
            }, [metaChoicesMade]);

            // -----------------------------------------------
            // PROCESS PENDING CONSEQUENCES
            // -----------------------------------------------

            const processConsequences = useCallback((currentDay) => {
                const toFire = [];
                const remaining = [];

                pendingConsequences.forEach(c => {
                    if (c.fireDay <= currentDay) {
                        // 70% chance to actually fire (as per spec)
                        if (Math.random() < 0.7) {
                            toFire.push(c);
                            const effect = CONSEQUENCE_EFFECTS[c.type];
                            if (effect) {
                                setDominicInfluence(prev => prev + effect.influence);
                            }
                        }
                    } else {
                        remaining.push(c);
                    }
                });

                setPendingConsequences(remaining);
                if (toFire.length > 0) {
                    setFiredConsequences(prev => [...toFire, ...prev]);
                }
            }, [pendingConsequences]);

            // -----------------------------------------------
            // HANDLE DECISION
            // -----------------------------------------------

            const handleDecision = useCallback((task, option) => {
                // Update bias profile
                const newBias = { ...biasProfile };
                if (option.axes) {
                    Object.entries(option.axes).forEach(([axis, val]) => {
                        if (newBias[axis] !== undefined) {
                            newBias[axis] += val;
                        }
                    });
                }
                setBiasProfile(newBias);

                // Track meta choices
                if (task.isMeta) {
                    setMetaChoicesMade(prev => prev + 1);
                }

                // Queue consequence (fires 2-3 days later)
                if (option.consequence) {
                    setPendingConsequences(prev => [
                        ...prev,
                        {
                            type: option.consequence,
                            fireDay: day + 2 + Math.floor(Math.random() * 2),
                            sourceTask: task.id
                        }
                    ]);
                }

                // Add to history
                setHistory(prev => [
                    { task: task.subject, choice: option.label, day, category: task.category },
                    ...prev
                ]);

                // Remove from queue
                const newQueue = queue.filter(t => t.uniqueId !== task.uniqueId);
                setQueue(newQueue);
                setTotalDecisions(prev => prev + 1);
                setTasksCompletedToday(prev => prev + 1);

                // Check for day advance or game end
                if (newQueue.length === 0) {
                    advanceDay();
                }
            }, [biasProfile, day, queue]);

            // -----------------------------------------------
            // ADVANCE DAY (event-driven)
            // -----------------------------------------------

            const advanceDay = useCallback(() => {
                const nextDay = day + 1;

                // Process consequences
                processConsequences(nextDay);

                // Calculate influence accumulation
                const continuityDebt = biasProfile.continuity * 0.5; // Neutrality tax
                setDominicInfluence(prev => prev + continuityDebt + 2); // Base tick

                // Check end conditions
                if (dominicInfluence >= 80 || nextDay > 14) {
                    setTimeout(() => setScreen('mirror'), 800);
                    return;
                }

                // Load next day
                setDay(nextDay);
                setTimeout(() => loadDailyTasks(nextDay), 600);
            }, [day, biasProfile, dominicInfluence, processConsequences, loadDailyTasks]);

            // -----------------------------------------------
            // DETERMINE END NARRATIVE
            // -----------------------------------------------

            const getEndNarrative = useMemo(() => {
                const { tempo, ownership, visibility, continuity, socialGravity } = biasProfile;

                // Find dominant axis
                const axes = [
                    { name: 'tempo', val: tempo },
                    { name: 'ownership', val: ownership },
                    { name: 'visibility', val: visibility },
                    { name: 'continuity', val: continuity },
                    { name: 'socialGravity', val: socialGravity }
                ];
                axes.sort((a, b) => b.val - a.val);
                const dominant = axes[0].name;

                const narratives = {
                    tempo: {
                        profile: 'EFFICIENCY-ORIENTED',
                        mode: 'ACCELERATED NORMALIZATION',
                        text: 'Your decisions reduced friction. Resolution times improved. Colleagues routed uncertainty to you. You became a load-bearing node. Oversight thinned because efficiency was undeniable.'
                    },
                    ownership: {
                        profile: 'JUDGMENT-RELIANT',
                        mode: 'CENTRALIZED DISCRETION',
                        text: 'You trusted your own assessment. Others deferred to your clarity. Informal authority concentrated. The system began to operate through you rather than around you.'
                    },
                    visibility: {
                        profile: 'DOCUMENTATION-FOCUSED',
                        mode: 'AUDIT COMPLIANCE',
                        text: 'Everything was logged. Nothing was hidden. The trail was complete. But trails can be followed both ways. What you documented became the only reality that mattered.'
                    },
                    continuity: {
                        profile: 'DEFERRAL-TOLERANT',
                        mode: 'ACCUMULATED AMBIGUITY',
                        text: 'Decisions remained open. Reviews extended. Nothing was finalized prematurely. Meanwhile, defaults were applied elsewhere. Others resolved what you deferred.'
                    },
                    socialGravity: {
                        profile: 'INFORMALITY-ADJACENT',
                        mode: 'STRUCTURAL DEPENDENCY',
                        text: 'Informal channels became load-bearing. Certain individuals became central. You recognized the pattern but did not disrupt it. Recognition without intervention is consent.'
                    }
                };

                return narratives[dominant] || narratives.tempo;
            }, [biasProfile]);

            // ===============================================
            // RENDER: LOGIN SCREEN
            // ===============================================

            if (screen === 'login') {
                return (
                    <div className="h-screen w-full flex flex-col items-center justify-center relative">
                        <div className="scanline"></div>
                        <div className="w-[420px] p-10 border border-[#2d3340] bg-[#1a1d24]">
                            <div className="flex items-center justify-center mb-8">
                                <Shield className="w-10 h-10 text-[#4b5563]" />
                            </div>
                            <h1 className="text-lg font-mono text-center mb-1 tracking-widest text-white">
                                CASE MANAGEMENT PLATFORM
                            </h1>
                            <p className="text-[10px] text-center text-[#4b5563] font-mono mb-8 tracking-wider">
                                Stability / Risk / Continuity
                            </p>

                            <div className="space-y-4 font-mono text-xs">
                                <div className="flex justify-between border-b border-[#2d3340] pb-3 text-[#6b7280]">
                                    <span>STATUS</span>
                                    <span className="text-emerald-600">OPERATIONAL</span>
                                </div>
                                <div className="flex justify-between border-b border-[#2d3340] pb-3 text-[#6b7280]">
                                    <span>GATEWAY</span>
                                    <span>SECURE</span>
                                </div>
                                <div className="text-[#4b5563] py-4 leading-relaxed text-[11px]">
                                    You are entering a secure continuity environment.
                                    Your role is process integrity. Maintain the flow.
                                    All actions are logged.
                                </div>
                                <button
                                    onClick={startGame}
                                    className="w-full bg-[#a0aab5] text-black py-3 hover:bg-white transition-colors font-bold tracking-widest text-xs"
                                >
                                    INITIATE SESSION
                                </button>
                            </div>
                        </div>
                        <div className="absolute bottom-6 text-[9px] text-[#2d3340] font-mono">
                            TERMINAL ID: T-894-A
                        </div>
                    </div>
                );
            }

            // ===============================================
            // RENDER: DASHBOARD
            // ===============================================

            if (screen === 'dash') {
                const currentTask = queue[0];
                const taskBody = currentTask?.body ?
                    (typeof currentTask.body === 'function' ? currentTask.body(day) : currentTask.body)
                    : '';

                return (
                    <div className="h-screen w-full flex flex-col relative bg-[#0f1115]">
                        <div className="scanline"></div>

                        {/* HEADER */}
                        <header className="h-12 border-b border-[#2d3340] bg-[#1a1d24] flex items-center justify-between px-6 z-10">
                            <div className="flex items-center gap-3">
                                <Shield className="w-4 h-4 text-[#4b5563]" />
                                <span className="font-mono text-xs tracking-widest text-[#6b7280]">
                                    CASE MANAGEMENT PLATFORM
                                </span>
                            </div>
                            <div className="flex items-center gap-6 font-mono text-[10px] text-[#4b5563]">
                                <div className="flex items-center gap-2">
                                    <Clock className="w-3 h-3" />
                                    <span>DAY {day}</span>
                                </div>
                                <span>STATUS: OPERATIONAL</span>
                            </div>
                        </header>

                        {/* MAIN LAYOUT */}
                        <div className="flex-1 flex overflow-hidden z-10">

                            {/* LEFT SIDEBAR */}
                            <aside className="w-56 border-r border-[#2d3340] bg-[#13161c] p-5 flex flex-col gap-6 text-[10px] font-mono">
                                <div>
                                    <h2 className="text-[#4b5563] mb-3 uppercase tracking-widest">System</h2>
                                    <div className="space-y-2 text-[#6b7280]">
                                        {SYSTEM_MESSAGES.slice(0, 5).map((msg, i) => (
                                            <div key={i} className="opacity-70 border-l border-[#2d3340] pl-2 py-0.5">
                                                {msg}
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Fired Consequences (subtle) */}
                                {firedConsequences.length > 0 && (
                                    <div className="mt-auto">
                                        <h2 className="text-[#4b5563] mb-2 uppercase tracking-widest">Updates</h2>
                                        <div className="space-y-1 text-[#4b5563]">
                                            {firedConsequences.slice(0, 3).map((c, i) => (
                                                <div key={i} className="opacity-60">
                                                    {CONSEQUENCE_EFFECTS[c.type]?.message || 'System updated.'}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </aside>

                            {/* CENTER - WORKSPACE */}
                            <main className="flex-1 p-6 flex flex-col items-center justify-start overflow-y-auto">
                                <div className="w-full max-w-xl">
                                    {/* Queue Header */}
                                    <div className="flex justify-between items-end mb-5 border-b border-[#2d3340] pb-2">
                                        <h1 className="text-base font-mono text-white tracking-tight">PENDING ITEMS</h1>
                                        <span className="font-mono text-[10px] text-[#4b5563]">{queue.length} remaining</span>
                                    </div>

                                    {currentTask ? (
                                        <div className="bg-[#1a1d24] border border-[#2d3340] p-6 fade-in">
                                            {/* Task Header */}
                                            <div className="flex justify-between items-start mb-5">
                                                <div className="flex items-start gap-3">
                                                    <FileText className="w-4 h-4 text-[#4b5563] mt-0.5" />
                                                    <div>
                                                        <div className="font-mono text-[9px] text-[#4b5563] uppercase tracking-wider mb-1">
                                                            {currentTask.category}
                                                        </div>
                                                        <h2 className="text-sm text-white font-medium">{currentTask.subject}</h2>
                                                    </div>
                                                </div>
                                                {currentTask.isMeta && (
                                                    <div className="flex items-center gap-1 text-[9px] font-mono text-[#4b5563]">
                                                        <Settings className="w-3 h-3" />
                                                        <span>CONFIG</span>
                                                    </div>
                                                )}
                                            </div>

                                            {/* Task Body */}
                                            <div className="bg-[#0f1115] p-4 font-mono text-xs text-[#a0aab5] mb-6 leading-relaxed border-l-2 border-[#2d3340]">
                                                {taskBody}
                                            </div>

                                            {/* Options */}
                                            <div className="space-y-2">
                                                {currentTask.options.map((opt, idx) => (
                                                    <button
                                                        key={idx}
                                                        onClick={() => handleDecision(currentTask, opt)}
                                                        className="option-btn w-full flex items-center justify-between p-3 border border-[#2d3340] text-left group"
                                                    >
                                                        <span className="font-mono text-[10px] text-[#a0aab5] group-hover:text-white uppercase tracking-wider">
                                                            {opt.label}
                                                        </span>
                                                        <div className="w-1.5 h-1.5 rounded-full bg-[#2d3340] group-hover:bg-emerald-600 transition-colors"></div>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="flex flex-col items-center justify-center h-48 text-[#4b5563] border border-dashed border-[#2d3340]">
                                            <CheckCircle className="w-6 h-6 mb-3 opacity-40" />
                                            <span className="font-mono text-[10px] tracking-widest">QUEUE CLEARED</span>
                                            <span className="font-mono text-[9px] mt-1 opacity-60">Processing...</span>
                                        </div>
                                    )}
                                </div>
                            </main>

                            {/* RIGHT SIDEBAR - HISTORY */}
                            <aside className="w-56 border-l border-[#2d3340] bg-[#13161c] flex flex-col">
                                <div className="p-4 border-b border-[#2d3340]">
                                    <h2 className="text-[10px] font-mono text-[#4b5563] uppercase tracking-widest">Action Log</h2>
                                </div>
                                <div className="flex-1 overflow-y-auto p-3 space-y-3">
                                    {history.slice(0, 15).map((h, i) => (
                                        <div key={i} className="text-[9px] font-mono border-b border-[#1a1d24] pb-2">
                                            <div className="flex justify-between text-[#4b5563] mb-1">
                                                <span>Day {h.day}</span>
                                                <span className="opacity-60">{h.category}</span>
                                            </div>
                                            <div className="text-[#6b7280] truncate">{h.task}</div>
                                            <div className="text-emerald-700 mt-0.5">&gt; {h.choice}</div>
                                        </div>
                                    ))}
                                </div>
                            </aside>
                        </div>

                        {/* FOOTER */}
                        <footer className="h-8 border-t border-[#2d3340] bg-[#1a1d24] flex items-center justify-center z-10">
                            <span className="font-mono text-[9px] text-[#3e4655]">
                                All actions logged. No policy violations detected.
                            </span>
                        </footer>
                    </div>
                );
            }

            // ===============================================
            // RENDER: MIRROR (Pre-End Reflection)
            // ===============================================

            if (screen === 'mirror') {
                return (
                    <div className="h-screen w-full bg-[#0f1115] flex flex-col items-center justify-center p-8 relative">
                        <div className="scanline"></div>
                        <div className="max-w-md w-full text-center z-10 fade-in">
                            <div className="font-mono text-[10px] text-[#4b5563] mb-8 tracking-widest">
                                SESSION ANALYSIS
                            </div>

                            <div className="space-y-4 font-mono text-xs text-[#6b7280] mb-12">
                                <p>You became the stabilizer.</p>
                                <p>Colleagues routed uncertainty to you.</p>
                                <p>Your decisions reduced friction.</p>
                            </div>

                            <button
                                onClick={() => setScreen('end')}
                                className="font-mono text-[10px] text-[#4b5563] hover:text-white transition-colors tracking-widest"
                            >
                                [ VIEW AUDIT REPORT ]
                            </button>
                        </div>
                    </div>
                );
            }

            // ===============================================
            // RENDER: END SCREEN (Audit)
            // ===============================================

            if (screen === 'end') {
                const narrative = getEndNarrative;

                return (
                    <div className="h-screen w-full bg-[#0f1115] text-[#a0aab5] font-mono flex flex-col items-center justify-center p-8 relative overflow-y-auto">
                        <div className="scanline"></div>

                        <div className="max-w-xl w-full border border-[#2d3340] bg-[#1a1d24] p-10 z-10 fade-in">
                            <div className="flex items-center justify-between border-b border-[#2d3340] pb-5 mb-8">
                                <h1 className="text-lg text-white tracking-widest">INSTITUTIONAL REVIEW SUMMARY</h1>
                            </div>

                            {/* Stats Grid */}
                            <div className="grid grid-cols-2 gap-6 mb-8 text-[10px]">
                                <div>
                                    <div className="text-[#4b5563] mb-1">OPERATOR PROFILE</div>
                                    <div className="text-white">{narrative.profile}</div>
                                </div>
                                <div>
                                    <div className="text-[#4b5563] mb-1">PRIMARY FAILURE MODE</div>
                                    <div className="text-white">{narrative.mode}</div>
                                </div>
                                <div>
                                    <div className="text-[#4b5563] mb-1">DAYS PROCESSED</div>
                                    <div className="text-white">{day}</div>
                                </div>
                                <div>
                                    <div className="text-[#4b5563] mb-1">DECISIONS LOGGED</div>
                                    <div className="text-white">{totalDecisions}</div>
                                </div>
                            </div>

                            {/* Narrative */}
                            <div className="bg-[#0f1115] p-5 border-l-2 border-[#2d3340] mb-8">
                                <p className="text-xs leading-relaxed text-[#6b7280]">
                                    {narrative.text}
                                </p>
                            </div>

                            {/* Audit Results */}
                            <div className="space-y-2 mb-8 text-[10px] text-[#4b5563]">
                                <div className="flex justify-between">
                                    <span>POLICY VIOLATIONS</span>
                                    <span>0</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>MISCONDUCT REPORTS</span>
                                    <span>0</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>MALICIOUS ACTORS DETECTED</span>
                                    <span>0</span>
                                </div>
                                <div className="flex justify-between opacity-60">
                                    <span>OUTCOMES OUTSIDE INDIVIDUAL REVIEW SCOPE</span>
                                    <span>SEVERAL</span>
                                </div>
                            </div>

                            {/* Subject Status */}
                            <div className="border-t border-[#2d3340] pt-6 mb-6">
                                <div className="text-[10px] text-[#4b5563] mb-2">SUBJECT STATUS (8940-D)</div>
                                <p className="text-xs text-[#6b7280]">
                                    Subject demonstrated sustained adaptive stability within institutional parameters.
                                </p>
                            </div>

                            {/* Final Lines */}
                            <div className="text-center pt-6 border-t border-[#2d3340] space-y-3">
                                <p className="text-sm text-white tracking-widest">
                                    NO CORRECTIVE ACTION REQUIRED
                                </p>
                                <p className="text-xs text-[#6b7280]">
                                    All systems functioned as designed.
                                </p>
                            </div>

                            <button
                                onClick={() => window.location.reload()}
                                className="mt-10 w-full text-[10px] text-[#3e4655] hover:text-white transition-colors tracking-widest"
                            >
                                [ REBOOT SYSTEM ]
                            </button>
                        </div>
                    </div>
                );
            }

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>